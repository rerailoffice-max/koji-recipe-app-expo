# 明日のタスク一覧

## 完了したタスク（本日）
✅ タブバーのUI調整（Web/iOS最適化）
✅ ホーム画面カードのレイアウト改善
✅ 材料の見切れ防止
✅ 調理時間のみ表示（カロリー・塩分非表示）

---

## 明日実施するタスク

### 🔴 優先度：高（ユーザー体験に直結）

#### 1. Googleアカウント完全削除対応
**現状**: レシピなどのデータは削除されるが、Supabase Authのアカウント自体は残っている  
**対応**: APIサーバー側で `auth.admin.deleteUser()` を呼び出すよう修正

**実装箇所**:
- APIサーバー: `/api/auth/delete-account` エンドポイント
- フロント側: `app/settings.tsx` の `handleDeleteAccount` は既に実装済み

**手順**:
1. APIサーバーのコードを確認
2. Supabase Admin APIを使用してユーザーアカウントを削除
3. テスト: Googleアカウントでログイン→削除→再ログイン試行（失敗することを確認）

---

#### 2. メール/Googleログイン後の動作統一
**現状**: メールアドレスログインでは、ログイン前のAIメニュー生成が編集画面に表示されるが、Gmailログインでは表示されない

**対応**: ログイン後のレシピ保存・編集画面表示のロジックを統一

**実装箇所**:
- `app/login.tsx` または `app/auth/callback.tsx`
- LocalStorage/AsyncStorageに保存されている一時レシピデータの取得ロジック

**手順**:
1. ログイン方法別の動作フローを確認
2. LocalStorageのキー名や保存タイミングを検証
3. Google OAuth後のコールバック処理を確認
4. テスト: ログアウト→AIメニュー生成→Gmailログイン→編集画面に表示されることを確認

---

### 🟡 優先度：中（機能追加）

#### 3. 会話画面で最後のAI提案を再表示
**現状**: レシピのメニュー案を生成後、下書き保存前に会話画面に戻ると、提案が消えて参照できない

**対応**: LocalStorage/AsyncStorageに最後のAI提案を一時保存し、UIで再表示できるようにする

**実装箇所**:
- `app/(tabs)/compose.tsx` または会話画面のコンポーネント
- チャットメッセージの状態管理

**手順**:
1. AI提案メッセージをLocalStorageに保存
2. 会話画面に「最後の提案を表示」ボタンまたは自動復元機能を追加
3. 提案から直接「下書きに保存」アクションを実行できるようにする

---

#### 4. AIメニュー案のフィードバック機能
**現状**: AIが生成したメニュー案に対して、ユーザーがフィードバックを送れない

**対応**: 
- 各AIメッセージに「いいね👍」「バッド👎」アイコンを追加
- フィードバックをAPIサーバーに送信してログ保存

**実装箇所**:
- チャットメッセージコンポーネント（`components/chat/`）
- APIサーバー: 新規エンドポイント `/api/feedback` を作成

**手順**:
1. チャットメッセージUIにフィードバックボタンを追加
2. APIサーバーにフィードバック受信エンドポイントを実装
3. Supabaseに `feedback` テーブルを作成（必要に応じて）
4. ログをSupabaseまたはログファイルに保存

---

#### 5. 意見ボックス機能
**現状**: アプリやAI機能に対する一般的なフィードバックを送る方法がない

**対応**: プロフィール画面の右上（カートアイコンの横）に「ご意見ボックス」アイコンを配置

**実装箇所**:
- `app/(tabs)/profile.tsx`
- モーダルまたは別画面でフィードバックフォームを表示
- APIサーバー: `/api/feedback/general` エンドポイント

**手順**:
1. プロフィール画面のヘッダーに「ご意見」アイコンを追加
2. フィードバックフォーム画面/モーダルを作成（テキストエリア+送信ボタン）
3. APIサーバーにフィードバック保存エンドポイントを実装
4. 送信後に「ありがとうございました」メッセージを表示

---

### 🟢 優先度：低（プロンプト改善）

#### 6. AIに「でんぷん質×麹」制約を指導
**参考資料**: `/Users/oshiroyoshiki/Documents/72_Cursor/01-koji-project/docs/recipe_corpus.md`

**現状**: AIがでんぷん質（米・芋・小麦など）と麹を組み合わせる際の注意点を考慮していない

**対応**: APIサーバー側のプロンプトに以下の制約を追加

**制約内容**:
```
## でんぷん質（米・芋・小麦など）と麹の組み合わせ注意

でんぷん質は麹の酵素で分解されやすく、水っぽく/崩れやすくなる。
加熱せずに使う場合は以下に注意:

- おにぎり: 混ぜて握るとポロポロ崩れやすい
- ポテトサラダ: そのまま混ぜるとドロドロ → 麹を一度加熱してから混ぜる
- 春雨サラダ: 時間が経つとベチャっと水っぽい → 炒め物など火を通す
- わかめご飯: たまねぎこうじは炊飯時に入れる（炊飯後に混ぜると水っぽい）

**対策**: でんぷん食材を使う場合は、麹調味料をしっかり加熱して使う
```

**実装箇所**:
- APIサーバー: `/api/chat` のシステムプロンプト

**手順**:
1. `recipe_corpus.md` の内容を確認
2. システムプロンプトに制約を追加
3. テスト: 「おにぎり」「ポテトサラダ」などでメニュー案を生成し、注意喚起が含まれるか確認

---

#### 7. 調理時間の計算ロジック確認・調整
**現状**: 調理時間が長すぎる傾向がある

**対応**: APIサーバー側で調理時間計算ロジックを確認・調整

**実装箇所**:
- APIサーバー: `/api/extract-recipe` または調理時間計算ロジック
- プロンプトに「簡潔な調理時間を見積もる」指示を追加

**手順**:
1. 現在の調理時間計算ロジックを確認
2. AIプロンプトに「実際の調理時間を短めに見積もる」指示を追加
3. テストレシピで調理時間を確認・調整

---

## 実装の優先順位（推奨）

### Day 1（明日）
1. **Googleアカウント完全削除対応**（30分）
2. **メール/Googleログイン後の動作統一**（1時間）
3. **会話画面で最後のAI提案を再表示**（1時間）

### Day 2
4. **AIメニュー案のフィードバック機能**（1.5時間）
5. **意見ボックス機能**（1時間）

### Day 3
6. **AIに「でんぷん質×麹」制約を指導**（30分）
7. **調理時間の計算ロジック確認・調整**（30分）

---

## 参考ファイル

### フロントエンド
- `app/settings.tsx` - アカウント削除機能
- `app/login.tsx` - ログイン画面
- `app/auth/callback.tsx` - OAuth コールバック
- `app/(tabs)/compose.tsx` - レシピ作成画面
- `app/(tabs)/profile.tsx` - プロフィール画面
- `components/chat/` - チャットコンポーネント

### APIサーバー（別リポジトリ）
- `/api/auth/delete-account` - アカウント削除エンドポイント
- `/api/chat` - AIチャットエンドポイント
- `/api/extract-recipe` - レシピ抽出エンドポイント

### ドキュメント
- `/Users/oshiroyoshiki/Documents/72_Cursor/01-koji-project/docs/recipe_corpus.md` - レシピ制約・ガイドライン

---

## メモ

- 本日（2026-01-17）はUIの微調整に時間を費やしたため、機能実装タスクは持ち越し
- タブバーとカードレイアウトは最適化完了、デプロイ済み
- Git コミット: `62103eb` "UI改善: タブバーとカードのレイアウト調整"
